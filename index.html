
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>AI光構師 - 構圖輔助</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: sans-serif;
    }
    #container {
      position: relative;
      width: 100vw;
      height: 100vh;
      background: black;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }
    canvas {
      position: absolute;
      top: 0;
      left: 0;
      pointer-events: none;
    }
    #controls {
      position: absolute;
      bottom: 10px;
      width: 100%;
      display: flex;
      justify-content: space-around;
      z-index: 10;
    }
    button {
      padding: 10px 16px;
      font-size: 14px;
      border-radius: 8px;
      border: none;
      background-color: #444;
      color: white;
    }
  </style>
</head>
<body>
  <div id="container">
    <video id="video" autoplay playsinline></video>
    <canvas id="overlay"></canvas>
    <div id="controls">
      <button onclick="drawGrid('thirds')">三分法</button>
      <button onclick="drawGrid('grid')">九宮格</button>
      <button onclick="drawGrid('diagonal')">對角線</button>
    </div>
  </div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('overlay');
    const ctx = canvas.getContext('2d');
    let currentMode = 'thirds';

    async function startCamera() {
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video: true });
        video.srcObject = stream;
      } catch (err) {
        if (err.name === "NotFoundError") {
          alert("⚠️ 找不到任何可用的相機裝置，請確認：\n- 裝置是否有鏡頭\n- 相機是否被其他應用程式佔用\n- 是否已授權瀏覽器使用相機");
        } else if (err.name === "NotAllowedError") {
          alert("⚠️ 存取相機的權限被拒絕，請允許瀏覽器使用相機");
        } else {
          alert("⚠️ 無法開啟相機：" + err.message);
        }
      }
    }

    function resizeCanvas() {
      canvas.width = video.clientWidth;
      canvas.height = video.clientHeight;
    }

    function drawGrid(mode) {
      currentMode = mode;
      resizeCanvas();
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      const w = canvas.width;
      const h = canvas.height;

      ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
      ctx.lineWidth = 1;

      if (mode === 'thirds' || mode === 'grid') {
        let cols = 3, rows = 3;
        for (let i = 1; i < cols; i++) {
          const x = (w / cols) * i;
          ctx.beginPath();
          ctx.moveTo(x, 0);
          ctx.lineTo(x, h);
          ctx.stroke();
        }
        for (let i = 1; i < rows; i++) {
          const y = (h / rows) * i;
          ctx.beginPath();
          ctx.moveTo(0, y);
          ctx.lineTo(w, y);
          ctx.stroke();
        }
      }

      if (mode === 'diagonal') {
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(w, h);
        ctx.stroke();

        ctx.beginPath();
        ctx.moveTo(w, 0);
        ctx.lineTo(0, h);
        ctx.stroke();
      }
    }

    video.addEventListener('loadedmetadata', () => {
      resizeCanvas();
      drawGrid(currentMode);
    });

    window.addEventListener('resize', () => {
      resizeCanvas();
      drawGrid(currentMode);
    });

    startCamera();
  </script>
</body>
</html>
